FROM golang:1.20-buster AS build

WORKDIR /app

COPY Makefile ./

COPY go.mod ./
COPY go.sum ./

COPY cmd ./cmd
COPY codes ./codes
COPY controllers ./controllers
COPY models ./models
COPY repositories ./repositories
COPY simulator ./simulator
COPY socket ./socket
COPY webserver ./webserver

COPY docker/config.json ./

RUN make install-dep && make build


FROM debian:buster-slim 

WORKDIR /

COPY --from=build /app/bin/lwnsimulator lwnsimulator 

COPY docker ./

EXPOSE 8000
EXPOSE 8001

ENV SIM_BRIDGE_HOST 172.17.0.1
ENV SIM_BRIDGE_PORT 1700

ENV DEV_EUI 0000000000000001
ENV DEV_ADDR 00be1557
ENV DEV_NWK_SKEY 00000000000000000000000000000001
ENV DEV_APP_SKEY 00000000000000000000000000000010
ENV DEV_APP_KEY 00000000000000000000000000000100
ENV DEV_NAME VirtualSensor
ENV DEV_MYTYPE ConfirmedDataUp
ENV DEV_PAYLOAD 123
ENV DEV_INFO_UPLINK_FPORT 2
ENV DEV_REGION EU868
ENV DEV_CONF_DATARATE 0

ENV DEV_RXS0_FREQUPLINK 868100000
ENV DEV_RXS0_FREQDOWNLINK 868100000
ENV DEV_RXS0_MINDR 0
ENV DEV_RXS0_MAXDR 5
ENV DEV_RXS0_DATARATE 0

ENV DEV_RXS1_FREQUPLINK 0
ENV DEV_RXS1_FREQDOWNLINK 869525000
ENV DEV_RXS1_MINDR 0
ENV DEV_RXS1_MAXDR 0
ENV DEV_RXS1_DATARATE 0

ENV GTW_MAC_ADDRESSE 0000000000000001
ENV GTW_NAME VirtualGateway


ENTRYPOINT [ "./entrypoint.sh" ]
